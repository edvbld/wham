\documentclass[11pt,oneside,a4paper]{article}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{stmaryrd}
\usepackage{trfrac}

\newenvironment{changemargin}[2]{%
\begin{list}{}{%
\setlength{\topsep}{0pt}%
\setlength{\leftmargin}{#1}%
\setlength{\rightmargin}{#2}%
\setlength{\listparindent}{\parindent}%
\setlength{\itemindent}{\parindent}%
\setlength{\parsep}{\parskip}%
}%
\item[]}{\end{list}}
  
\begin{document}
\title{Report for Lab Assignment 1, DD2457 Program Semantics and Analysis}
\author{Erik Helin}
\date{\today}
\maketitle

\section*{New Rules}
The following new rules have been added to the various semantics:
\subsection*{Natural semantics}
\begingroup
\addtolength{\jot}{.5em}
\begin{align*}
[\text{try}_{ns}^1] \quad \quad &
<\texttt{try}\: S_1 \: \texttt{catch}\: S_2, \hat{s}> \rightarrow \hat{s} \\
[\text{try}_{ns}^2] \quad \quad &
\frac{<S_1,s> \rightarrow s^{'}}
     {<\texttt{try}\: S_1 \: \texttt{catch} \: S_2, s> \rightarrow s^{'}}  \\
[\text{try}_{ns}^3] \quad \quad &
\frac{<S_1,s> \rightarrow \hat{s}, \: <S_2, \hat{s}> \rightarrow s^{'}}
     {<\texttt{try}\: S_1 \: \texttt{catch} \: S_2, s> \rightarrow s^{'}} \\
[\text{ass}_{ns}^2] \quad \quad &
<x := a, \hat{s}> \rightarrow \hat{s} \\
[\text{ass}_{ns}^3] \quad \quad &
<x := a, s> \rightarrow \hat{s} \quad 
\text{if} \: \mathcal{A} \llbracket a \rrbracket s = \bot \\
[\text{skip}_{ns}^2] \quad \quad &
<\texttt{skip}, \hat{s}> \rightarrow \hat{s} \\
[\text{comp}_{ns}^2] \quad \quad &
<S_1;S_2, \hat{s}> \rightarrow \hat{s} \\
[\text{comp}_{ns}^3] \quad \quad &
\frac{<S_1, s> \rightarrow \hat{s}}{<S_1;S_2, s> \rightarrow \hat{s}} \\
[\text{comp}_{ns}^4] \quad \quad &
\frac{<S_1, s> \rightarrow s^{'}, <S_2, s^{'}> \rightarrow \hat{s}}
{<S_1;S_2, s> \rightarrow \hat{s}} \\
[\text{if}_{ns}^{\:3}] \quad \quad & <\texttt{if}\:b\: \texttt{then}\:  S_1 \: 
\texttt{else} \: S_2, \hat{s}> \rightarrow \hat{s} \\
[\text{if}_{ns}^{\:4}] \quad \quad & \frac{<S_1, s> \rightarrow \hat{s}}
{ <\texttt{if}\:b\: \texttt{then}\:  S_1 \: \texttt{else} \: S_2, s> 
\rightarrow \hat{s}} \quad \text{if} \: \mathcal{B} \llbracket b \rrbracket s
= \textbf{tt}\\
[\text{if}_{ns}^{\:5}] \quad \quad & \frac{<S_2, s> \rightarrow \hat{s}}
{ <\texttt{if}\:b\: \texttt{then}\:  S_1 \: \texttt{else} \: S_2, s> 
\rightarrow \hat{s}} \quad \text{if} \: \mathcal{B} \llbracket b \rrbracket s
= \textbf{ff}\\
[\text{if}_{ns}^{\:6}] \quad \quad & <\texttt{if}\:b\: \texttt{then}\:  S_1 \: 
\texttt{else} \: S_2, s> \rightarrow \hat{s} \quad 
\text{if} \: \mathcal{B} \llbracket b \rrbracket s
= \bot \\
[\text{while}_{ns}^3] \quad \quad & <\texttt{while}\: b \:\texttt{do}\: S, 
\hat{s}> \rightarrow \hat{s} \\
[\text{while}_{ns}^4] \quad \quad & 
<\texttt{while}\: b \:\texttt{do}\: S, s> \rightarrow \hat{s} 
\quad \text{if} \: \mathcal{B} \llbracket b \rrbracket s = \bot \\
[\text{while}_{ns}^5] \quad \quad & 
\frac{<S,s> \rightarrow s^{'}, <\texttt{while}\: b \: \texttt{do} \: S, s^{'}>
\rightarrow \hat{s}}
{<\texttt{while}\: b \: \texttt{do}\: S, s> \rightarrow \hat{s}} 
\quad \text{if} \: \mathcal{B} \llbracket b \rrbracket s = \textbf{tt} \\
\end{align*}
\endgroup

\subsection*{AM instructions}
\begin{align*}
\text{DIV}\: |\: \text{TRY}\:(c,c)\: |\: \text{CATCH}\:(c)
\end{align*}

\subsection*{AM Stuctural Operational Rules}
\begingroup
\addtolength{\jot}{.5em}
\begin{align*}
<\text{DIV}:c, n_1:n_2:e, s> \: &\triangleright <c, (n_1 / n_2):e, s>& \quad 
\text{if} \; n_1, n_2 \in \mathbb{Z}, n_2 \neq 0 \\
<\text{DIV}:c, n_1:n_2:e, s> \: &\triangleright <c, e, \hat{s}>& \quad
\text{if} \; n_1, n_2 \in \mathbb{Z}, n_2 = 0 \\
<\text{TRY}\:(c_1, c_2):c, e, s> \: &\triangleright 
<c_1:\text{CATCH}\:(c_2):c, e, s>& \\
<\text{CATCH}\:(c_1):c, e, s>\: &\triangleright <c, e, s>& \\
<\text{CATCH}\:(c_1):c, e, \hat{s}>\: &\triangleright <c_1:c, e, s>& \\
<c_1:c, e, \hat{s}>\: &\triangleright <c, e, \hat{s}>&
\end{align*}
\endgroup

\subsection*{Derivation tree}
\begin{changemargin}{-2.5cm}{\rightmargin}
\[
\trfrac[\(\text{comp}_{ns}\)]{
\trfrac[\(\text{ass}_{ns}\)]{s_0[x \mapsto 7]}{<x := 7, s_0> \rightarrow s_2}
\trfrac[\(\text{try}^3_{ns}\)]{
\trfrac[\(\text{comp}_{ns}\)]{T_1}
{<x := x - 7; x := 7 / x; x := x + 7, s_2> \rightarrow \hat{s}_3} 
\trfrac[\(\text{ass}_{ns}\)]{T_2}
{<x := x - 7, \hat{s}_3> \rightarrow s_1}}
{<\textbf{try}\: x := x - 7; x := 7 / x; x := x + 7 \: \textbf{catch}\:
x := x - 7, s_2> \rightarrow s_1}}
{<x := 7; \textbf{try}\: x := x - 7; x := 7 / x; x := x + 7 \: \textbf{catch}\:
x := x - 7, s_0> \rightarrow s_1}
\]
\end{changemargin}
\[
\trfrac[]{
\trfrac[\(\text{ass}_{ns}\)]{s_2[x \mapsto s_2(x) - 7]}
{<x := x - 7, s_2> \rightarrow s_3}
\trfrac[\(\text{comp}_{ns}\)]{
<x := 7/x, s_3> \rightarrow \hat{s_3} <x := x + 7, \hat{s_3}> \rightarrow \hat{s}_3}
{<x := 7 / x; x := x + 7, s_3> \rightarrow \hat{s}_3}
}{T_1}
\]
\end{document}
